# 集合
集合是专门被设计用来存储和检索数据的**类**。这些集合类并不是C#语法组成的一部分，而是.NET框架下定义的，位于 `System.Collection` 命名空间下。

本章节只介绍各集合类型的简单使用，更多内容可以参考集合相关的API。

## 一、动态数组

### 01 ArrayList
数组（array）在声明时通常会指定大小，而一旦确定后，数组大小就无法改变了。为了使数组更加灵活，因此定义了动态数组（ArrayList）。动态数组是可以自动调整大小的数据结构，允许在列表中进行动态内存分配、增加、搜索、排序等操作。

`ArrayList` 继承体系：
```csharp
public class ArrayList : ICloneable, System.Collections.IList
```

ArrayList 是无序的，即添加的元素不是按规则排序的，而是根据添加顺序进行存储，因此在执行某些操作前需要进行排序（Sort）。ArrayList 允许存储 null ，并且允许重复元素，ArrayList 索引从0开始。

!!! Tip
	ArrayList 不是类型安全的，添加元素时会将数据装箱成object类型，取数据时也会进行拆箱，性能较差。

| 构造函数               | 说明                                                                             |
|:---------------------- |:-------------------------------------------------------------------------------- |
| ArrayList()            | 初始化实例，该实例为空，容量采用默认容量。                                         |
| ArrayList(ICollection) | 初始化实例，该实例包含从指定集合复制的元素，容量与元素数相同。 |
| ArrayList(Int32)       | 初始化实例，该实例为空，容量为指定的值。|                                                                                 |

| 属性           | 说明                                      | 属性 | 说明 | 
|:-------------- |:----------------------------------------- | ---- | ---- |
| Capacity       | 容量                                      |  IsFixedSize    | 集合是否是固定大小      |
| Count          | 元素数                                    |     IsReadOnly     | 集合是否是只读的              |
| SyncRoot       | 获取可用于同步对 ArrayList 的访问的对象。 |    IsSynchronized | 是否同步对 ArrayList 的访问（线程安全）  |

| 方法                 | 说明               | 方法            | 说明                 |
|:-------------------- |:------------------ |:--------------- |:-------------------- |
| Add(Object)          | 添加元素到结尾     | Remove(Object)  | 移除第一个匹配的对象 |
| Contains(Object)     | 判断元素是否存在   | Clear()         | 移除所有元素         |
| Insert(Int32,Object) | 在指定位置插入元素 | RemoveAt(Int32) | 移除指定位置的元素   |
| Reverse()            | 顺序反转           | Sort()          | 排序                 |
| ToArray()            | 转换为Object数组   | TrimToSize()      | 将容量设为元素数目|                     |
更多 [ArrayList API](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.arraylist?view=net-7.0 ) 

### 02 List<T\>

ArrayList 中曾介绍过，它不是数据安全的，并且频繁的装箱拆箱会有性能消耗，基于以上种种，官方推出泛型 `List<T>` 类，并推荐使用它：
1. 当存储同类型的对象时，建议使用 `List<T>`；
2. 当存储不同类型的对象时，建议使用 `List<object>` .

`List<T>` 继承体系：
```csharp
public class List<T> : 
	System.Collections.Generic.ICollection<T>, 
	System.Collections.Generic.IEnumerable<T>, 
	System.Collections.Generic.IList<T>, 
	System.Collections.Generic.IReadOnlyCollection<T>, 
	System.Collections.Generic.IReadOnlyList<T>, 
	System.Collections.IList
```

!!! Tip
	`List<T>` 是 ArrayList 的泛型等效项，在大多数情况下，该类比 ArrayList 性能更好，并且类型安全。

关于 `List<T>` 的构造函数、属性、方法等与 ArrayList 类似，详细可参考 [List<T\>](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.generic.list-1?view=net-7.0 ) 。

`List<T>` ==不是线程安全的==，可以安全地对某个 [List<T\>](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.generic.list-1?view=net-7.0)集合执行多个读取操作，但如果正在读取集合时修改集合，则可能会出现问题。 
若要确保线程安全，请在读取或写入操作期间**锁定集合**。 
若要允许多个线程访问集合以读取和写入，必须实现自己的同步。

有关具有内置同步的集合，请参阅命名空间中的 [System.Collections.Concurrent](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent?view=net-7.0) 类。 有关固有线程安全的替代方法，请参阅 [ImmutableList<T\>](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutablelist-1?view=net-7.0) 该类。

## 二、键值集合
### 01 Hashtable
Hashtable 类代表了一系列基于**键的哈希代码**组织起来的**键/值**对，使用**键**来访问集合中的元素。

Hashtable 继承体系：
```csharp
public class Hashtable : 
	ICloneable, 
	System.Collections.IDictionary,
	System.Runtime.Serialization.IDeserializationCallback,
	System.Runtime.Serialization.ISerializable
```

Hashtable 键不允许为 `null`，但值可以。

!!! Tip
	与ArrayList类似，不建议将 `Hashtable` 类用于新开发。 相反，建议使用泛型 Dictionary <K,V> 类.

### 02 Dictionary<K, V\>
只要对象用作 [Dictionary<TKey,TValue>](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.generic.dictionary-2?view=net-7.0)键，它就不得以任何影响其哈希值的方式更改。 根据字典的相等比较器，中的每个 [Dictionary<TKey,TValue>](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.generic.dictionary-2?view=net-7.0) 键都必须是唯一的。 如果键的类型为引用类型，则键不能`null`为 ，但值可以是 。

Dictionary<K,V\>的遍历：
```csharp
foreach( KeyValuePair<string, string> kvp in myDictionary )
{
    Console.WriteLine("Key = {0}, Value = {1}", kvp.Key, kvp.Value);
}
```

!!! Danger
	foreach 语句只允许从集合读取，不允许在遍历时对集合进行增删改。

`Dictionary<K, V>` ==不是线程安全的== ，在遍历与写入访问相争的极少数情况下，必须在整个枚举期间锁定集合。 若要允许多个线程访问集合以进行读写操作，则必须实现自己的同步。

有关线程安全的替代，请参阅 [ConcurrentDictionary<TKey,TValue>](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentdictionary-2?view=net-7.0) 类或 [ImmutableDictionary<TKey,TValue>](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutabledictionary-2?view=net-7.0) 类。

## 三、排序集合
### 01 SortedList

### 02 SortedList<T，V\>


## 四、堆栈
### 01 Stack

### 02 Stack<T\>

## 五、队列
### 01 Queue

### 02 Queue<T\>


## 六、点列阵



