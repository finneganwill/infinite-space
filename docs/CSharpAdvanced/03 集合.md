# 集合
集合是专门被设计用来存储和检索数据的**类**。这些集合类并不是C#语法组成的一部分，而是.NET框架下定义的，位于 `System.Collection` 命名空间下。

定义 - 继承体系 - 特点 - API - 注意事项

## 一、动态数组

### 01 ArrayList
#### 定义
数组（array）在声明时通常会指定大小，而一旦确定后，数组大小就无法改变了。为了使数组更加灵活，因此定义了动态数组（ArrayList）。动态数组是可以自动调整大小的数据结构，允许在列表中进行动态内存分配、增加、搜索、排序等操作。

#### 继承体系
`ArrayList` 继承体系：
```csharp
public class ArrayList : ICloneable, System.Collections.IList
```

#### 特点
1. ArrayList 是 ==无序的==，即添加的元素不是按规则排序的，而是根据添加顺序进行存储，因此在执行某些操作前需要进行排序（Sort）；
2. ArrayList ==允许存储 null== ；
3. ArrayList ==可以存储重复元素== ；
4. ArrayList ==不是线程安全的==，要保证线程安全，所有操作都必须通过 [Synchronized(IList)](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.arraylist.synchronized?view=net-7.0#system-collections-arraylist-synchronized(system-collections-ilist)) 方法返回的包装器来完成。

枚举整个集合本质上不是一个线程安全的过程。 即使某个集合已同步，其他线程仍可以修改该集合，这会导致枚举数引发异常。 若要确保枚举过程中的线程安全性，可以在整个枚举期间**锁定集合**，或者捕获由其他线程进行的更改所导致的异常。

!!! Tip
	ArrayList 不是类型安全的，添加元素时会将数据装箱成object类型，取数据时也会进行拆箱，性能较差。

#### 操作
下面为集合的遍历、添加元素、移除元素等基本操作，更过 API 指路：[ArrayList API](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.hashtable?view=net-7.0) 。

=== "实例化"

=== "遍历"

=== "添加"

=== "移除"


### 02 List<T\>
#### 定义
ArrayList 中曾介绍过，它不是数据安全的，并且频繁的装箱拆箱会有性能消耗，基于以上种种，官方推出泛型 `List<T>` 类，并推荐使用它：
1. 当存储同类型的对象时，建议使用 `List<T>`；
2. 当存储不同类型的对象时，建议使用 `List<object>` .

#### 继承体系
`List<T>` 继承体系：
```csharp
public class List<T> : 
	System.Collections.Generic.ICollection<T>, 
	System.Collections.Generic.IEnumerable<T>, 
	System.Collections.Generic.IList<T>, 
	System.Collections.Generic.IReadOnlyCollection<T>, 
	System.Collections.Generic.IReadOnlyList<T>, 
	System.Collections.IList
```

#### 特点
`List<T>` ==不是线程安全的==，可以安全地对某个 [List<T\>](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.generic.list-1?view=net-7.0)集合执行多个读取操作，但如果正在读取集合时修改集合，则可能会出现问题。 若要确保线程安全，请在读取或写入操作期间**锁定集合**。 若要允许多个线程访问集合以读取和写入，必须实现自己的同步。

有关具有内置同步的集合，请参阅命名空间中的 [System.Collections.Concurrent](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent?view=net-7.0) 类。 有关固有线程安全的替代方法，请参阅 [ImmutableList<T\>](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutablelist-1?view=net-7.0) 该类。

!!! Tip
	`List<T>` 是 ArrayList 的泛型等效项，在大多数情况下，该类比 ArrayList 性能更好，并且类型安全。

#### 操作
下面为集合的遍历、添加元素、移除元素等基本操作，更过 API 指路：[List<T\> API](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.generic.list-1?view=net-7.0 ) 。

=== "实例化"

=== "遍历"

=== "添加"

=== "移除"


## 二、键值集合
### 01 Hashtable
#### 定义
Hashtable 类代表了一系列基于 **键的哈希代码** 组织起来的**键/值**对，使用 **键** 来访问集合中的元素。

#### 继承体系
```csharp
public class Hashtable : 
	ICloneable, 
	System.Collections.IDictionary,
	System.Runtime.Serialization.IDeserializationCallback,
	System.Runtime.Serialization.ISerializable
```

#### 特点
1. Hashtable 是无序的，根据添加顺序存储；
2. Hashtable 的 Key 不允许为 `null`，但 Value 可以；
3. Hashtable 的 Key 不允许重复，但不同键的 Value 可以；
4. Hashtable 是 ==线程安全的== ，可供多个读取器线程和单个写入线程使用。

!!! Tip
	与ArrayList类似，Hashtable 不是类型安全的，不建议将 `Hashtable` 类用于新开发。 相反，建议使用泛型 Dictionary <K,V> 类.

#### 操作
下面为集合的遍历、添加元素、移除元素等基本操作，更过 API 指路：[Hashtable API](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.hashtable?view=net-7.0) 。

=== "实例化"

=== "遍历"

=== "添加"

=== "移除"

### 02 Dictionary<K, V\>
#### 定义
只要对象用作 Dictionary<K, V> 键，它就不得以任何影响其哈希值的方式更改。 根据字典的相等比较器， Dictionary<K, V> 中的每个键都必须是唯一的。 如果键的类型为引用类型，则键不能为 `null`  ，但值可以是 。

#### 继承体系
```csharp
public class Dictionary<TKey,TValue> : 
System.Collections.Generic
	.ICollection<System.Collections.Generic.KeyValuePair<TKey,TValue>>, 
	.IDictionary<TKey,TValue>, 
	.IEnumerable<System.Collections.Generic.KeyValuePair<TKey,TValue>>, 
	.IReadOnlyCollection<System.Collections.Generic.KeyValuePair<TKey,TValue>>, 
	.IReadOnlyDictionary<TKey,TValue>, 
System.Collections.IDictionary, System.Runtime.Serialization
	.IDeserializationCallback, 
	.ISerializable
```

#### 特点
`Dictionary<K, V>` ==不是线程安全的== ，在遍历与写入访问相争的极少数情况下，必须在整个枚举期间锁定集合。 若要允许多个线程访问集合以进行读写操作，则必须实现自己的同步。

有关线程安全的替代，请参阅 [ConcurrentDictionary<TKey,TValue>](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.concurrent.concurrentdictionary-2?view=net-7.0) 类或 [ImmutableDictionary<TKey,TValue>](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.immutable.immutabledictionary-2?view=net-7.0) 类。

#### 操作
下面为集合的遍历、添加元素、移除元素等基本操作，更过 API 指路：。

=== "实例化"

=== "遍历"
	```csharp
	foreach( KeyValuePair<string, string> kvp in myDictionary )
	{
	    Console.WriteLine("Key = {0}, Value = {1}", kvp.Key, kvp.Value);
	}
	```
=== "添加"

=== "移除"



!!! Danger
	foreach 语句只允许从集合读取，不允许在遍历时对集合进行增删改。


## 三、排序键值集合
### 01 SortedList
#### 定义
SortedList 也是使用键值存储元素的集合，这些键值对 **按键排序** 并可按照键和索引访问。

索引序列基于排序序列。 添加元素时，它将按正确的排序顺序插入到 中 SortedList，索引会相应地调整。 删除元素时，索引也会相应地进行调整。 因此，在对象中添加或移除元素时，特定键/值对的 SortedList 索引可能会更改。

#### 继承体系
```csharp
public class SortedList : ICloneable, System.Collections.IDictionary
```

#### 特点
1. SortList 对象内部通过两个数组来维护元素，一个用于键，一个用于关联值；
2. SortList 的键不能为 `null` ，但值可以；
3. SortList 的键不允许重复，但不同键的值可以相等；
4. 由于需要进行排序，SortList 比 Hashtable 慢，但是灵活性更高；
5. 集合的每个元素都是可作为 DictionaryEntry 对象访问的键/值对。

!!! Tip
	不建议使用 `SortedList` 类进行新的开发。 建议改用泛型System.Collections.Generic.SortedList<TKey,TValue> 类。

#### 操作
下面为集合的遍历、添加元素、移除元素等基本操作，更过 API 指路：。

=== "实例化"

=== "遍历"
	```csharp
	foreach (DictionaryEntry de in mySortedList)
	{
	    //...
	}
	```
=== "添加"

=== "移除"

### 02 SortedList<K，V\>
#### 定义
表示基于相关的 [IComparer<T\>](https://learn.microsoft.com/zh-cn/dotnet/api/system.collections.generic.icomparer-1?view=net-7.0) 实现按键进行排序的键/值对的集合。

#### 继承体系
```csharp
public class SortedList<TKey,TValue> : 
System.Collections.Generic
	.ICollection<System.Collections.Generic.KeyValuePair<TKey,TValue>>, 
	.IDictionary<TKey,TValue>, 
	.IEnumerable<System.Collections.Generic.KeyValuePair<TKey,TValue>>, 
	.IReadOnlyCollection<System.Collections.Generic.KeyValuePair<TKey,TValue>>, 
	.IReadOnlyDictionary<TKey,TValue>, 
System.Collections.IDictionary
```

#### 特点
1. SortedList<K，V> 实现为键/值对数组，按键排序，每个元素都可以作为 KeyValuePair<K，V> 对象进行检索；
2. SortedList<K，V> 键允许不能为 null，但值可以；
3. SortedList<K，V> 键不能重复，但不同键的值可以
4. SortedList<K，V> 不是线程安全的。

SortedList<K，V> 只要集合未修改，就可以同时支持多个读取器。 即便如此，通过集合枚举本质上也不是线程安全的过程。 若要确保枚举过程中的线程安全性，可以在整个枚举过程中锁定集合。 若要允许多个线程访问集合以进行读写操作，则必须实现自己的同步。

#### 操作
=== "实例化"

=== "遍历"
	```csharp
	foreach( KeyValuePair<int, string> kvp in mySortedList )
	{
	    Console.WriteLine("Key = {0}, Value = {1}", kvp.Key, kvp.Value);
	}
	```
=== "添加"

=== "移除"


## 四、堆栈
### 01 Stack
#### 定义
非泛型的栈结构，元素按照先进后出（FILO）原则存取。

#### 继承体系
```csharp
public class Stack : ICloneable, System.Collections.ICollection
```

#### 特点
1. Stack 结构先进后出；
2. Stack 是非泛型的，因此元素按 Object 类型；
3. Stack 允许 null 值，允许重复元素；
4. Satck 不是线程安全的。

为了保证Stack的线程安全，所有操作都必须通过Synchronized(Stack)方法返回的包装器来完成。  

枚举集合本质上不是线程安全的过程。即使在同步集合时，其他线程仍然可以修改集合，这将导致枚举器抛出异常。为了保证枚举期间的线程安全，您可以在整个枚举期间锁定集合，或者捕获由其他线程所做的更改所导致的异常。

#### 操作
=== "实例化"

=== "遍历"

=== "添加"

=== "移除"

### 02 Stack<T\>
#### 定义
栈结构的泛型类型，元素类型应为 `T` 或 派生自 `T`。

#### 继承体系
```csharp
public class Stack<T> : 
	System.Collections.Generic.IEnumerable<T>, 
	System.Collections.Generic.IReadOnlyCollection<T>, 
	System.Collections.ICollection
```

#### 特点
1. Stack<T\> 结构先进后出；
2. Stack<T\> 是非泛型的，因此元素按 Object 类型；
3. Stack<T\> 允许 null 值，允许重复元素；
4. Stack<T\> 不是线程安全的。

只要不修改集合，Stack<T\> 就可以同时支持多个读取器。即便如此，通过集合进行枚举本质上也不是线程安全的过程。若要保证枚举期间的线程安全，可以在整个枚举期间锁定集合。若要允许多个线程访问集合以进行读取和写入，必须实现自己的同步。

#### 操作
=== "实例化"

=== "遍历"

=== "添加"

=== "移除"


## 五、队列
### 01 Queue
#### 定义
非泛型的队列结构，元素按照先进先出（FIFO）原则存取。

#### 继承体系
```csharp
public class Queue : ICloneable, System.Collections.ICollection
```

#### 特点
1. Queue 结构只能从一端插入，从另一端删除，因此是先进先出的；
2. Queue 通过容量因子来完成扩容，新容量 = 容量因子 * 当前容量，容量因子默认为 2.0；
3. Queue 允许 `null` 和重复元素；
4. Queue 不是线程安全的。

为了保证Queue的线程安全，所有操作都必须通过Synchronized(Queue)方法返回的包装器来完成。  

枚举集合本质上不是线程安全的过程。即使在同步集合时，其他线程仍然可以修改集合，这将导致枚举器抛出异常。为了保证枚举期间的线程安全，您可以在整个枚举期间锁定集合，或者捕获由其他线程所做的更改所导致的异常。

!!! Tip
	当您可能希望在检索元素的值后丢弃该元素时。如果需要按照信息在集合中的存储顺序访问信息，请使用队列。如果希望以相反顺序访问信息，请使用堆栈。

#### 操作
=== "实例化"

=== "遍历"

=== "添加"

=== "移除"


### 02 Queue<T\>
#### 定义

#### 继承体系
```public class Queue<T> : 
	System.Collections.Generic.IEnumerable<T>, 
	System.Collections.Generic.IReadOnlyCollection<T>, System.Collections.ICollection
```
#### 特点

#### 操作




## 六、点列阵


## 七、总结

| 集合      | 定义                  | 重复元素 | 存储null   | 线程安全   | API导航 | 特点               |
|:--------- |:--------------------- |:-------- |:---------- |:---------- |:------- | ------------------ |
| ArrayList | 动态数组              | 可重复   | 可存储null | 非线程安全 |         | 类型不安全         |
| List<T\>  | ArrayList的泛型等效项 | 可重复   | 可存储null | 非线程安全 |         | 泛型保证了类型安全 |
|           |                       |          |            |            |         |                    |
|           |                       |          |            |            |         |                    |
|           |                       |          |            |            |         |                    |
|           |                       |          |            |            |         |                    |
|           |                       |          |            |            |         |                    |


