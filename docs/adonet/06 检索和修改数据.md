## 一、命令与参数
### 01 DbCommand

建立与数据源的连接后，可以使用 [DbCommand](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.common.dbcommand) 对象来执行命令并从数据源中返回结果，可以使用命令构造函数之一为要使用的 .NET Framework 数据提供程序创建命令。

每个 Data Provider 都具有一个 DbCommand 对象[^1] —— OleDbCommand、SqlCommand、OdbcCommand、OracleCommand。


每个对象中都包含指定如何解释命令字符串的 [CommandType](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.commandtype) 枚举属性，可以通过该属性设置让命令字符串按何种规则被解释执行，枚举选项如下：

- `Text` ：定义要在数据源处执行的语句的 SQL 命令；
- `StoredProcedure` ：存储过程的名称。 您可以使用某一命令的 `Parameters` 属性访问输入和输出参数，并返回值（无论调用哪种 `Execute` 方法）。 当使用 `ExecuteReader` 时，在关闭 `DataReader` 后才能访问返回值和输出参数；
- `TableDirect` ：表的名称。

### 02 配置命令参数
通过提供类型检查和验证，命令对象可使用参数来将值传递给 SQL 语句或存储过程。

与命令文本不同，参数输入被视为文本值，而不是可执行代码。 这样可帮助抵御“SQL 注入”攻击，这种攻击的攻击者会将命令插入 SQL 语句，从而危及服务器的安全。参数化命令还可提高查询执行性能，因为它们可帮助数据库服务器将传入命令与适当的缓存查询计划进行准确匹配。除具备安全和性能优势外，参数化命令还提供一种用于组织传递到数据源的值的便捷方法。

[DbParameter](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.common.dbparameter) 对象可以通过使用其构造函数来创建，或者也可以通过调用 [DbParameterCollection](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.common.dbcommand.dbparametercollection) 集合的 `Add` 方法以将该对象添加到 [DbParameterCollection](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.common.dbparametercollection) 来创建。 `Add` 方法将构造函数实参或现有形参对象用作输入，具体取决于数据提供程序。

在添加参数时，您必须为输入参数以外的参数提供一个 [ParameterDirection](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.parameterdirection) 属性。 下表显示了可用于 `ParameterDirection` 枚举的 [ParameterDirection](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.parameterdirection) 值。
[Input](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.parameterdirection#system-data-parameterdirection-input) ： 该参数为输入参数。 这是默认值。
[InputOutput](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.parameterdirection#system-data-parameterdirection-inputoutput) ：该参数可执行输入和输出。
[Output](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.parameterdirection#system-data-parameterdirection-output)　：该参数为输出参数。
[ReturnValue](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.parameterdirection#system-data-parameterdirection-returnvalue)：该参数表示从某操作（如存储过程、内置函数或用户定义的函数）返回的值。

参数占位符的语法取决于数据源。 .NET Framework 数据提供程序以不同方式处理命名和指定参数和参数占位符。 此语法是针对某个特定的数据源自定义的，如下表所述。
[System.Data.SqlClient](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.sqlclient)：以 `@`_参数名_格式使用命名参数。
[System.Data.OleDb](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.oledb)：使用由问号 (?) 指示的位置参数标记。
[System.Data.Odbc](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.odbc)：使用由问号 (`?`) 指示的位置参数标记。
[System.Data.OracleClient](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.oracleclient)：以 `:`_参数名_ （或 _参数名_）格式使用命名参数。

## 二、DataReader检索数据

### 01 DataReader
可以使用 DataReader 从数据库中检索<mark style="background: #CACFD9A6;">只读、只进</mark>的数据流。 查询结果在查询执行时返回，在并存储在客户端的网络缓冲区中，直到使用 DataReader 的 Read 方法对它们发出请求。 使用 DataReader 可以提高应用程序的性能，原因是它只要数据可用就立即检索数据，并且（默认情况下）一次只在内存中存储一行，减少了系统开销。

每个数据提供程序都具有一个DbDataReader 对象 [^1]（`OleDbDataReader`、`SqlDataReader` 、`OdbcDataReader`、`OracleDataReader` ）。



!!! Note "如何选择 DataSet 和 DataReader ？"
	使用 `DataSet` 可执行以下操作：
	1. 在应用程序中将数据缓存在本地，以便可以对数据进行处理。 如果只需要读取查询结果，则 `DataReader` 是更好的选择。
	2. 在层间或从 XML Web services 对数据进行远程处理。
	3. 与数据进行动态交互，例如绑定到 Windows 窗体控件或组合并关联来自多个源的数据。
	4. 对数据执行大量的处理，而不需要与数据源保持打开的连接，从而将该连接释放给其他客户端使用。
	


## 三、DataAdapter检索数据

### 01 DataAdapter
[DataAdapter](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.common.dataadapter) 用于从数据源检索数据并填充 [DataSet](https://learn.microsoft.com/zh-cn/dotnet/api/system.data.dataset) 中的表。 `DataAdapter` 还可将对 `DataSet` 所做的更改解析回数据源。 `DataAdapter` 使用 .NET Framework 数据提供程序的 `Connection` 对象连接到数据源，并使用 `Command` 对象从数据源检索数据以及将更改解析回数据源。

每个数据提供程序都具有一个 DbDataAdapter 对象[^3]（`OleDbDataAdapter` 、`SqlDataAdapter` 、`OdbcDataAdapter`、`OracleDataAdapter`）。




[^1]: 适用于 OLE DB 的 OleDbCommand 对象；适用于 SQL Server 的 SqlCommand 对象；适用于 ODBC 的 OdbcCommand 对象；适用于 Oracle 的 OracleCommand 对象。

[^2]: 用于 OLE DB 的  OleDbDataReader 对象；用于 SQL Server 的 SqlDataReader 对象；用于 ODBC 的  OdbcDataReader 对象；用于 Oracle 的 OracleDataReader 对象。

[^3]:  用于 OLE DB 的 OleDbDataAdapter 对象；用于 SQL Server 的 SqlDataAdapter 对象；用于 ODBC 的 OdbcDataAdapter 对象；用于 Oracle 的 OracleDataAdapter 对象。